<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Type Ahead ğŸ‘€</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">
      <li>Filter for a city</li>
      <li>or a state</li>
    </ul>
  </form>
<script>
const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';

// ì‘ë‹µë°›ì€ ë°ì´í„°ë“¤ì„ ë‹´ì„ ë°°ì—´
const cities = [];

// ìœ„ì˜ ì£¼ì†Œë¡œ ìš”ì²­ì„ ë³´ë‚´ì„œ ì‘ë‹µì„ ë°›ì•„ì˜´.
// Ajax (Asynchronous JavaScript and XML: ë¹ ë¥´ê²Œ ë™ì‘í•˜ëŠ” ë™ì ì¸ ì›¹í˜ì´ì§€ë¥¼ ë§Œë“¤ê¸° ìœ„í•œ ê°œë°œ ê¸°ë²•)
// fetchë¡œ ìš”ì²­ ë³´ë‚´ë©´, í”„ë¡œë¯¸ìŠ¤ í˜•íƒœë¡œ ë°˜í™˜ ë°›ìŒ, then ìœ¼ë¡œ ê·¸ ë‹¤ìŒ ì‘ì—…ë“¤ ì‘ì„±
fetch(endpoint)
  .then(blob => blob.json())              // ë°ì´í„°ë¥¼ jsonìœ¼ë¡œ ë³€í™˜
  .then(data => cities.push(...data));    // ë°ì´í„°ë“¤ì„ í•˜ë‚˜ì”© cities ë°°ì—´ì—ë‹¤ê°€ ë‹´ìŒ


// ë°ì´í„°ê°€ ìˆëŠ” ë°°ì—´ ë‚´ì— ê²€ìƒ‰í•˜ëŠ” ë¬¸ìì™€ ì¼ì¹˜í•˜ëŠ”ê²Œ ìˆëŠ” ë°ì´í„°ë¥¼ ì°¾ì•„ì˜¤ëŠ” í•¨ìˆ˜
function findMatches(wordToMatch, cities) {
  return cities.filter(place => {
    // ì •ê·œí‘œí˜„ì‹, g(global)-ë¬¸ìì—´ ë‚´ì—ì„œ ëª¨ë“ ê²Œ ì¼ì¹˜í•˜ê±°ë‚˜ ì²˜ìŒì— ì¼ì¹˜í•˜ëŠ”ê²ƒë“¤ / i(ignoreCase)-ë¬¸ìì—´ ëŒ€ì†Œë¬¸ì êµ¬ë¶„í•˜ì§€ ì•ŠìŒ
    const regex = new RegExp(wordToMatch, "gi");
    return place.city.match(regex) || place.state.match(regex);
  });
}


// ì…ë ¥ì°½ê³¼ ê²°ê³¼ì°½ì˜ selector ë¥¼ í• ë‹¹
const searchInput = document.querySelector(".search");
const suggestions = document.querySelector(".suggestions");

// ìˆ«ìë¥¼ 3ìë¦¬ìˆ˜ë§ˆë‹¤ ì»´ë§ˆë¥¼ ë„£ì–´ì£¼ëŠ” í•¨ìˆ˜
function numberWithCommas(x) {
  return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

// ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë°œìƒì‹œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ (ì…ë ¥ê°’ì´ ë³€í•˜ë©´ í˜¸ì¶œë¨)
function displayMatches() {
  const matchArray = findMatches(this.value, cities);   // ê²€ìƒ‰ì´ ì¼ì¹˜í•˜ëŠ”ê²ƒë“¤ì´ ë°°ì—´ì— ì €ì¥ë¨
  const html = matchArray.map(place => {                // ê²°ê³¼ë“¤ í•˜ë‚˜í•˜ë‚˜ì— í•¨ìˆ˜ ì ìš©
    const regex = new RegExp(this.value, "gi");
    const cityName = place.city.replace(regex, `<span class="hl">${this.value}</span>`);
    const stateName = place.state.replace(regex, `<span class="hl">${this.value}</span>`);
    
    // html íƒœê·¸ë¡œ ë§Œë“¤ì–´ì„œ ë°˜í™˜
    return `
      <li>
        <span class="name">${cityName}, ${stateName}</span>
        <span class="population">${numberWithCommas(place.population)}</span>
      </li>
    `
  }).join("");    // ë’¤ì— join ì„ ë¶™ì—¬ì•¼ í•˜ë‚˜ì˜ í…ìŠ¤íŠ¸ë¡œ ë°˜í™˜í•˜ê²Œ ë¨ / ë¶™ì´ì§€ ì•Šìœ¼ë©´ ë¦¬ìŠ¤íŠ¸ í˜•ì‹ìœ¼ë¡œ ë‚˜íƒ€ë‚¨

  // innerHTML - ì„ íƒí•œ íƒœê·¸ (suggestions) ìì†ë“¤ì„ ëª¨ë‘ ì œê±°í•˜ê³  ê·¸ ì•„ë˜ì— html ì„ ì§‘ì–´ ë„£ëŠ”ë‹¤.
  suggestions.innerHTML = html;
}

// ê°’ì´ ë³€í•˜ëŠ”ê±° ê°ì§€ ë¦¬ìŠ¤ë„ˆ (ì‹¤ì‹œê°„ìœ¼ë¡œ ë°˜ì˜ë˜ì§€ ì•ŠìŒ)
// searchInput.addEventListener("change", displayMatches);
// í‚¤ë³´ë“œê°€ ëˆŒë €ë‹¤ê°€ ë–¼ì§€ë©´ ì‹¤í–‰ë¨ (ê°’ì˜ ë³€í™”ì— ë”°ë¼ ë°”ë¡œë°”ë¡œ ë°œìƒë¨)
searchInput.addEventListener("keyup", displayMatches);

</script>
</body>
</html>
